<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Chore Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        h1 { text-align: center; }
        .btn { padding: 5px 10px; margin-top: 10px; }
        
        /* Section styles */
        .section-header { display: flex; align-items: center; }
        .add-button { 
            font-size: 20px; 
            cursor: pointer; 
            background-color: #007BFF; 
            color: white; 
            border: none; 
            padding: 2px 8px; 
            margin-left: 10px;
            border-radius: 50%; 
        }
        .task-item, .user-profile { border: 1px solid #ddd; padding: 10px; border-radius: 8px; margin-top: 10px; }
        
        .user-profile img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 50%;
        }

        .due-task { color: red; font-weight: bold; }
        .completed-task { color: green; text-decoration: line-through; }
        .form-container { margin-top: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>Family Chore Tracker</h1>

    <!-- Available Tasks Section -->
    <div id="homeScreen">
        <div class="section-header">
            <h2>Available Tasks</h2>
            <button class="add-button" onclick="toggleTaskForm()">+</button>
        </div>
        <div id="taskForm" class="form-container" style="display: none;">
            <h3>Add Task</h3>
            <label>Task Name: <input type="text" id="customTaskName"></label><br>
            <label>Value: <input type="number" id="customTaskValue"></label><br>
            <label>Due Type:
                <select id="dueType" onchange="toggleDueOptions()">
                    <option value="time">Due Time (Daily)</option>
                    <option value="interval">Due Every X Days</option>
                </select>
            </label><br>
            <label id="dueTimeLabel">Due Time: <input type="time" id="dueTime" value="19:00"></label><br>
            <label id="intervalLabel" style="display: none;">Interval (days): <input type="number" id="dueInterval" min="1" max="30" value="7"></label><br>
            <button onclick="addCustomTask()">Add Task</button>
            <button onclick="toggleTaskForm()">Cancel</button>
        </div>
        <div id="availableTasks"></div>

        <!-- Family Members Section -->
        <div class="section-header">
            <h2>Family Members</h2>
            <button class="add-button" onclick="toggleFamilyForm()">+</button>
        </div>
        <div id="familyForm" class="form-container" style="display: none;">
            <h3>Add Family Member</h3>
            <label>Name: <input type="text" id="memberName"></label><br>
            <label>Birthdate: <input type="date" id="memberBirthdate"></label><br>
            <label>Photo URL: <input type="text" id="memberPhoto" placeholder="Optional"></label><br>
            <button onclick="addFamilyMember()">Add Member</button>
            <button onclick="toggleFamilyForm()">Cancel</button>
        </div>
        <div id="familyMembers"></div>
    </div>

    <script>
        let familyMembers = [
            { name: "Mom", birthdate: "1980-05-15", photo: "https://via.placeholder.com/50", totalEarned: 120, tasks: [] },
            { name: "Dad", birthdate: "1982-08-23", photo: "https://via.placeholder.com/50", totalEarned: 85, tasks: [] },
        ];

        const predefinedTasks = [
            { name: "Load the Dishwasher", value: 5, type: "time", dueTime: "19:00", inHome: true },
            { name: "Clean the Washroom", value: 10, type: "interval", interval: 7, lastCompleted: null, inHome: true }
        ];

        // Toggle the Task Form
        function toggleTaskForm() {
            const taskForm = document.getElementById('taskForm');
            taskForm.style.display = taskForm.style.display === 'none' ? 'block' : 'none';
        }

        // Toggle the Family Form
        function toggleFamilyForm() {
            const familyForm = document.getElementById('familyForm');
            familyForm.style.display = familyForm.style.display === 'none' ? 'block' : 'none';
        }

        // Show or hide due options based on task type
        function toggleDueOptions() {
            const dueType = document.getElementById('dueType').value;
            document.getElementById('dueTimeLabel').style.display = dueType === 'time' ? 'block' : 'none';
            document.getElementById('intervalLabel').style.display = dueType === 'interval' ? 'block' : 'none';
        }

        // Add a new task to the available tasks
        function addCustomTask() {
            const name = document.getElementById('customTaskName').value;
            const value = parseFloat(document.getElementById('customTaskValue').value);
            const dueType = document.getElementById('dueType').value;
            let newTask;

            if (dueType === "time") {
                const dueTime = document.getElementById('dueTime').value;
                newTask = { name, value, type: "time", dueTime, inHome: true };
            } else {
                const interval = parseInt(document.getElementById('dueInterval').value);
                newTask = { name, value, type: "interval", interval, lastCompleted: null, inHome: true };
            }

            predefinedTasks.push(newTask);
            renderAvailableTasks();
            toggleTaskForm();
        }

        // Check if interval tasks are due based on the last completed date and interval
        function isTaskDue(task) {
            if (task.type === "time") {
                return true; // Time-based tasks are displayed daily
            } else if (task.type === "interval" && task.lastCompleted) {
                const now = new Date();
                const lastCompletedDate = new Date(task.lastCompleted);
                const daysSinceCompleted = Math.floor((now - lastCompletedDate) / (1000 * 60 * 60 * 24));
                return daysSinceCompleted >= task.interval;
            }
            return task.type === "interval" && !task.lastCompleted;
        }

        // Render available tasks on the Home Screen, including due interval tasks
        function renderAvailableTasks() {
            const availableTasksContainer = document.getElementById('availableTasks');
            availableTasksContainer.innerHTML = '';

            predefinedTasks.forEach((task, index) => {
                if (task.inHome && isTaskDue(task)) {
                    const taskDiv = document.createElement('div');
                    taskDiv.classList.add('due-task');
                    taskDiv.innerHTML = `
                        <div>${task.name} - $${task.value}</div>
                        <button onclick="assignTask(${index})">Assign</button>
                    `;
                    availableTasksContainer.appendChild(taskDiv);
                }
            });
        }

        function assignTask(taskIndex) {
            const familyMemberIndex = prompt("Enter family member's index (0 for Mom, 1 for Dad):");
            if (familyMemberIndex !== null && familyMembers[familyMemberIndex]) {
                const task = predefinedTasks[taskIndex];
                familyMembers[familyMemberIndex].tasks.push({ ...task, completed: false });

                // Update lastCompleted if the task is interval-based
                if (task.type === "interval") {
                    task.lastCompleted = new Date().toISOString(); // Store the last completed date
                }
                renderFamilyMembers();
            }
        }

        // Render family members on the Home Screen
        function renderFamilyMembers() {
            const familyContainer = document.getElementById('familyMembers');
            familyContainer.innerHTML = '';

            familyMembers.forEach((member, index) => {
                const age = calculateAge(member.birthdate);
                const memberDiv = document.createElement('div');
                memberDiv.classList.add('user-profile');

                memberDiv.innerHTML = `
                    <img src